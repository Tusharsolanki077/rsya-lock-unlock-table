<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Table Reservation Lock System</title>
  <link rel="stylesheet" href="style.css">  
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Table Reservation System</h1>
      <p>Secure table locking with real-time status monitoring</p>
    </div>

    <div class="grid">
      <div class="card">
        <div class="card-title">
          <div class="card-icon lock-icon">ðŸ”’</div>
          Lock Table
        </div>
        <form id="lockForm">
          <div class="form-group">
            <label class="form-label">Table ID</label>
            <input type="text" name="tableId" class="form-input" placeholder="Enter table identifier" required>
          </div>
          <div class="form-group">
            <label class="form-label">User ID</label>
            <input type="text" name="userId" class="form-input" placeholder="Enter your user ID" required>
          </div>
          <div class="form-group">
            <label class="form-label">Duration (seconds)</label>
            <input type="number" name="duration" class="form-input" placeholder="Lock duration" min="1" required>
          </div>
          <button type="submit" class="btn btn-lock">Lock Table</button>
        </form>
        <div id="lockResp" class="response"></div>
      </div>

      <div class="card">
        <div class="card-title">
          <div class="card-icon unlock-icon">ðŸ”“</div>
          Unlock Table
        </div>
        <form id="unlockForm">
          <div class="form-group">
            <label class="form-label">Table ID</label>
            <input type="text" name="tableId" class="form-input" placeholder="Enter table identifier" required>
          </div>
          <div class="form-group">
            <label class="form-label">User ID</label>
            <input type="text" name="userId" class="form-input" placeholder="Enter your user ID" required>
          </div>
          <button type="submit" class="btn btn-unlock">Unlock Table</button>
        </form>
        <div id="unlockResp" class="response"></div>
      </div>

      <div class="card">
        <div class="card-title">
          <div class="card-icon status-icon">ðŸ“Š</div>
          Check Status
        </div>
        <form id="statusForm">
          <div class="form-group">
            <label class="form-label">Table ID</label>
            <input type="text" name="tableId" class="form-input" placeholder="Enter table identifier" required>
          </div>
          <button type="submit" class="btn btn-status">Check Status</button>
        </form>
        <div id="statusResp" class="response"></div>
      </div>
    </div>

    <div class="info-section">
      <h3>How to Use</h3>
      <p>
        Enter your Table ID and User ID to lock or unlock tables. Set a duration for automatic lock expiration. 
        Check the status of any table to see its current lock state. All data is stored temporarily in memory 
        and will reset when the server restarts.
      </p>
    </div>
  </div>

  <script>
    function showResponse(elem, content, type = 'default') {
      elem.className = `response show ${type}`;
      elem.innerHTML = content;
    }

    function doPost(endpoint, data, respElem) {
      showResponse(respElem, '<span class="loading-spinner"></span>Loading...', 'loading');
      
      fetch(endpoint, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data),
      })
        .then(async r => {
          const txt = await r.text();
          let json;
          try { 
            json = JSON.parse(txt); 
          } catch { 
            json = { error: txt }; 
          }
          
          if (!r.ok) throw json;
          
          showResponse(respElem, '<pre>' + JSON.stringify(json, null, 2) + '</pre>', 'success');
        })
        .catch(e => {
          const errorMsg = e.message || JSON.stringify(e);
          showResponse(respElem, `<strong>Error:</strong> ${errorMsg}`, 'error');
        });
    }

    function doGet(endpoint, respElem) {
      showResponse(respElem, '<span class="loading-spinner"></span>Loading...', 'loading');
      
      fetch(endpoint)
        .then(r => r.json())
        .then(json => {
          showResponse(respElem, '<pre>' + JSON.stringify(json, null, 2) + '</pre>', 'success');
        })
        .catch(e => {
          const errorMsg = e.message || JSON.stringify(e);
          showResponse(respElem, `<strong>Error:</strong> ${errorMsg}`, 'error');
        });
    }

    document.getElementById('lockForm').onsubmit = function(e) {
      e.preventDefault();
      const tableId = this.tableId.value.trim();
      const userId = this.userId.value.trim();
      const duration = Number(this.duration.value);
      doPost('/api/tables/lock', {tableId, userId, duration}, document.getElementById('lockResp'));
    };

    document.getElementById('unlockForm').onsubmit = function(e) {
      e.preventDefault();
      const tableId = this.tableId.value.trim();
      const userId = this.userId.value.trim();
      doPost('/api/tables/unlock', {tableId, userId}, document.getElementById('unlockResp'));
    };

    document.getElementById('statusForm').onsubmit = function(e) {
      e.preventDefault();
      const tableId = this.tableId.value.trim();
      doGet('/api/tables/' + encodeURIComponent(tableId) + '/status', document.getElementById('statusResp'));
    };
  </script>
</body>
</html>